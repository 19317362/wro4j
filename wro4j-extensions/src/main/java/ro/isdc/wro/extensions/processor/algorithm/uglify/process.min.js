var jsp=require("./parse-js"),slice=jsp.slice,member=jsp.member,PRECEDENCE=jsp.PRECEDENCE,OPERATORS=jsp.OPERATORS;
function ast_walker(){function a(f){return[this[0],MAP(f,function(g){var p=[g[0]];if(g.length>1)p[1]=c(g[1]);return p})]}function c(f){if(f==null)return null;try{n.push(f);var g=f[0],p=o[g];if(p){var s=p.apply(f,f.slice(1));if(s!=null)return s}p=i[g];return p.apply(f,f.slice(1))}finally{n.pop()}}var i={string:function(f){return[this[0],f]},num:function(f){return[this[0],f]},name:function(f){return[this[0],f]},toplevel:function(f){return[this[0],MAP(f,c)]},block:function(f){var g=[this[0]];f!=null&&
g.push(MAP(f,c));return g},"var":a,"const":a,"try":function(f,g,p){return[this[0],MAP(f,c),g!=null?[g[0],MAP(g[1],c)]:null,p!=null?MAP(p,c):null]},"throw":function(f){return[this[0],c(f)]},"new":function(f,g){return[this[0],c(f),MAP(g,c)]},"switch":function(f,g){return[this[0],c(f),MAP(g,function(p){return[p[0]?c(p[0]):null,MAP(p[1],c)]})]},"break":function(f){return[this[0],f]},"continue":function(f){return[this[0],f]},conditional:function(f,g,p){return[this[0],c(f),c(g),c(p)]},assign:function(f,
g,p){return[this[0],f,c(g),c(p)]},dot:function(f){return[this[0],c(f)].concat(slice(arguments,1))},call:function(f,g){return[this[0],c(f),MAP(g,c)]},"function":function(f,g,p){return[this[0],f,g.slice(),MAP(p,c)]},defun:function(f,g,p){return[this[0],f,g.slice(),MAP(p,c)]},"if":function(f,g,p){return[this[0],c(f),c(g),c(p)]},"for":function(f,g,p,s){return[this[0],c(f),c(g),c(p),c(s)]},"for-in":function(f,g,p,s){return[this[0],c(f),c(g),c(p),c(s)]},"while":function(f,g){return[this[0],c(f),c(g)]},
"do":function(f,g){return[this[0],c(f),c(g)]},"return":function(f){return[this[0],c(f)]},binary:function(f,g,p){return[this[0],f,c(g),c(p)]},"unary-prefix":function(f,g){return[this[0],f,c(g)]},"unary-postfix":function(f,g){return[this[0],f,c(g)]},sub:function(f,g){return[this[0],c(f),c(g)]},object:function(f){return[this[0],MAP(f,function(g){return g.length==2?[g[0],c(g[1])]:[g[0],c(g[1]),g[2]]})]},regexp:function(f,g){return[this[0],f,g]},array:function(f){return[this[0],MAP(f,c)]},stat:function(f){return[this[0],
c(f)]},seq:function(){return[this[0]].concat(MAP(slice(arguments),c))},label:function(f,g){return[this[0],f,c(g)]},"with":function(f,g){return[this[0],c(f),c(g)]},atom:function(f){return[this[0],f]}},o={},n=[];return{walk:c,with_walkers:function(f,g){var p={},s;for(s in f)if(HOP(f,s)){p[s]=o[s];o[s]=f[s]}var t=g();for(s in p)if(HOP(p,s))if(p[s])o[s]=p[s];else delete o[s];return t},parent:function(){return n[n.length-2]},stack:function(){return n}}}
function Scope(a){this.names={};this.mangled={};this.rev_mangled={};this.cname=-1;this.refs={};this.uses_eval=this.uses_with=false;this.parent=a;this.children=[];if(a){this.level=a.level+1;a.children.push(this)}else this.level=0}var base54=function(){return function(a){var c="";do{c="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_".charAt(a%54)+c;a=Math.floor(a/54)}while(a>0);return c}}();
Scope.prototype={has:function(a){for(var c=this;c;c=c.parent)if(HOP(c.names,a))return c},has_mangled:function(a){for(var c=this;c;c=c.parent)if(HOP(c.rev_mangled,a))return c},toJSON:function(){return{names:this.names,uses_eval:this.uses_eval,uses_with:this.uses_with}},next_mangled:function(){for(;;){var a=base54(++this.cname),c;c=this.has_mangled(a);if(!(c&&this.refs[c.rev_mangled[a]]===c)){c=this.has(a);if(!(c&&c!==this&&this.refs[a]===c&&!c.has_mangled(a)))if(!(HOP(this.refs,a)&&this.refs[a]==null))if(is_identifier(a))return a}}},
get_mangled:function(a,c){if(this.uses_eval||this.uses_with)return a;var i=this.has(a);if(!i)return a;if(HOP(i.mangled,a))return i.mangled[a];if(!c)return a;var o=i.next_mangled();i.rev_mangled[o]=a;return i.mangled[a]=o},define:function(a){if(a!=null)return this.names[a]=a}};
function ast_add_scope(a){function c(s){n=new Scope(n);s=n.body=s();s.scope=n;n=n.parent;return s}function i(s){return n.define(s)}function o(s,t,k){return[this[0],i(s),t,c(function(){MAP(t,i);return MAP(k,g)})]}var n=null,f=ast_walker(),g=f.walk,p=[];return c(function(){function s(k,v){for(v=k.children.length;--v>=0;)s(k.children[v]);for(v in k.refs)if(HOP(k.refs,v))for(var e=k.has(v),j=k;j;j=j.parent){j.refs[v]=e;if(j===e)break}}var t=f.with_walkers({"function":o,defun:o,"with":function(){for(var k=
n;k;k=k.parent)k.uses_with=true},"var":function(k){MAP(k,function(v){i(v[0])})},"const":function(k){MAP(k,function(v){i(v[0])})},"try":function(k,v,e){if(v!=null)return[this[0],MAP(k,g),[i(v[0]),MAP(v[1],g)],e!=null?MAP(e,g):null]},name:function(k){k=="eval"&&p.push(n);n.refs[k]=true}},function(){return g(a)});MAP(p,function(k){if(!k.has("eval"))for(;k;){k.uses_eval=true;k=k.parent}});s(n);return t})}
function ast_mangle(a,c){function i(t,k){if(!c.toplevel&&!s.parent)return t;if(c.except&&member(t,c.except))return t;return s.get_mangled(t,k)}function o(t,k,v){if(t)t=i(t);v=n(v.scope,function(){k=MAP(k,function(e){return i(e)});return MAP(v,p)});return[this[0],t,k,v]}function n(t,k){var v=s;s=t;for(var e in t.names)HOP(t.names,e)&&i(e,true);e=k();e.scope=t;s=v;return e}function f(t){return[this[0],MAP(t,function(k){return[i(k[0]),p(k[1])]})]}var g=ast_walker(),p=g.walk,s;c=c||{};return g.with_walkers({"function":o,
defun:function(){var t=o.apply(this,arguments);switch(g.parent()[0]){case "toplevel":case "function":case "defun":return MAP.at_top(t)}return t},"var":f,"const":f,name:function(t){return[this[0],i(t)]},"try":function(t,k,v){return[this[0],MAP(t,p),k!=null?[i(k[0]),MAP(k[1],p)]:null,v!=null?MAP(v,p):null]},toplevel:function(t){var k=this;return n(k.scope,function(){return[k[0],MAP(t,p)]})}},function(){return p(ast_add_scope(a))})}var warn=function(){};
function best_of(a,c){return gen_code(a).length>gen_code(c[0]=="stat"?c[1]:c).length?c:a}function last_stat(a){if(a[0]=="block"&&a[1]&&a[1].length>0)return a[1][a[1].length-1];return a}function aborts(a){if(a){a=last_stat(a);if(a[0]=="return"||a[0]=="break"||a[0]=="continue"||a[0]=="throw")return true}}
function boolean_expr(a){return a[0]=="unary-prefix"&&member(a[1],["!","delete"])||a[0]=="binary"&&member(a[1],["in","instanceof","==","!=","===","!==","<","<=",">=",">"])||a[0]=="binary"&&member(a[1],["&&","||"])&&boolean_expr(a[2])&&boolean_expr(a[3])||a[0]=="conditional"&&boolean_expr(a[2])&&boolean_expr(a[3])||a[0]=="assign"&&a[1]===true&&boolean_expr(a[3])||a[0]=="seq"&&boolean_expr(a[a.length-1])}
function make_conditional(a,c,i){return a[0]=="unary-prefix"&&a[1]=="!"?i?["conditional",a[2],i,c]:["binary","||",a[2],c]:i?["conditional",a,c,i]:["binary","&&",a,c]}function empty(a){return!a||a[0]=="block"&&(!a[1]||a[1].length==0)}function is_string(a){return a[0]=="string"||a[0]=="unary-prefix"&&a[1]=="typeof"||a[0]=="binary"&&a[1]=="+"&&(is_string(a[2])||is_string(a[3]))}
var when_constant=function(){function a(i){switch(i[0]){case "string":case "num":return i[1];case "name":case "atom":switch(i[1]){case "true":return true;case "false":return false}break;case "unary-prefix":switch(i[1]){case "!":return!a(i[2]);case "typeof":return typeof a(i[2]);case "~":return~a(i[2]);case "-":return-a(i[2]);case "+":return+a(i[2])}break;case "binary":var o=i[2],n=i[3];switch(i[1]){case "&&":return a(o)&&a(n);case "||":return a(o)||a(n);case "|":return a(o)|a(n);case "&":return a(o)&
a(n);case "^":return a(o)^a(n);case "+":return a(o)+a(n);case "*":return a(o)*a(n);case "/":return a(o)/a(n);case "-":return a(o)-a(n);case "<<":return a(o)<<a(n);case ">>":return a(o)>>a(n);case ">>>":return a(o)>>>a(n);case "==":return a(o)==a(n);case "===":return a(o)===a(n);case "!=":return a(o)!=a(n);case "!==":return a(o)!==a(n);case "<":return a(o)<a(n);case "<=":return a(o)<=a(n);case ">":return a(o)>a(n);case ">=":return a(o)>=a(n);case "in":return a(o)in a(n);case "instanceof":return a(o)instanceof
a(n)}}throw c;}var c={};return function(i,o,n){try{var f=a(i),g;switch(typeof f){case "string":g=["string",f];break;case "number":g=["num",f];break;case "boolean":g=["name",String(f)];break;default:throw Error("Can't handle constant of type: "+typeof f);}return o.call(i,g,f)}catch(p){if(p===c){if(i[0]=="binary"&&(i[1]=="==="||i[1]=="!==")&&(is_string(i[2])&&is_string(i[3])||boolean_expr(i[2])&&boolean_expr(i[3])))i[1]=i[1].substr(0,2);return n?n.call(i,i):null}else throw p;}}}();
function warn_unreachable(a){empty(a)||warn("Dropping unreachable code: "+gen_code(a,true))}
function ast_squeeze(a,c){function i(e){var j=["unary-prefix","!",e];switch(e[0]){case "unary-prefix":return e[1]=="!"&&boolean_expr(e[2])?e[2]:j;case "seq":e=slice(e);e[e.length-1]=i(e[e.length-1]);return e;case "conditional":return best_of(j,["conditional",e[1],i(e[2]),i(e[3])]);case "binary":var m=e[1],l=e[2];e=e[3];if(!c.keep_comps)switch(m){case "<=":return["binary",">",l,e];case "<":return["binary",">=",l,e];case ">=":return["binary","<",l,e];case ">":return["binary","<=",l,e]}switch(m){case "==":return["binary",
"!=",l,e];case "!=":return["binary","==",l,e];case "===":return["binary","!==",l,e];case "!==":return["binary","===",l,e];case "&&":return best_of(j,["binary","||",i(l),i(e)]);case "||":return best_of(j,["binary","&&",i(l),i(e)])}}return j}function o(e,j){var m=v;v=e;var l=j();l.scope=e;v=m;return l}function n(e,j,m){return[this[0],e,j,o(m.scope,function(){return f(MAP(m,k),"lambda")})]}function f(e,j){e=e.reduce(function(m,l){if(l[0]=="block")l[1]&&m.push.apply(m,l[1]);else m.push(l);return m},[]);
e=function(m,l){e.forEach(function(u){if(l&&(u[0]=="var"&&l[0]=="var"||u[0]=="const"&&l[0]=="const"))l[1]=l[1].concat(u[1]);else{m.push(u);l=u}});return m}([]);if(c.dead_code)e=function(m,l){e.forEach(function(u){if(l)if(member(u[0],["function","defun","var","const"]))m.push(u);else c.no_warnings||warn_unreachable(u);else{m.push(u);if(member(u[0],["return","throw","break","continue"]))l=true}});return m}([]);if(c.make_seqs)e=function(m,l){e.forEach(function(u){if(l&&l[0]=="stat"&&u[0]=="stat")l[1]=
["seq",l[1],u[1]];else{m.push(u);l=u}});return m}([]);if(j=="lambda")e=function(m,l,u){for(;m<e.length;){u=e[m++];if(u[0]=="if"&&!u[3]){if(u[2][0]=="return"&&u[2][1]==null){l.push(g(i(u[1]),["block",e.slice(m)]));break}var q=last_stat(u[2]);if(q[0]=="return"&&q[1]==null){l.push(g(u[1],["block",u[2][1].slice(0,-1)],["block",e.slice(m)]));break}}l.push(u)}return l}(0,[]);return e}function g(e,j,m){return when_constant(e,function(l,u){if(u){warn_unreachable(m);return j}else{warn_unreachable(j);return m}},
function(){return p(e,j,m)})}function p(e,j,m){e=k(e);j=k(j);m=k(m);if(empty(j)){e=i(e);j=m;m=null}else if(empty(m))m=null;else(function(){var u=gen_code(e),q=i(e);if(gen_code(q).length<u.length){u=j;j=m;m=u;e=q}})();if(empty(m)&&empty(j))return["stat",e];var l=["if",e,j,m];if(j[0]=="if"&&empty(j[3])&&empty(m))l=best_of(l,k(["if",["binary","&&",e,j[1]],j[2]]));else if(j[0]=="stat")if(m){if(m[0]=="stat")l=best_of(l,["stat",make_conditional(e,j[1],m[1])])}else l=best_of(l,["stat",make_conditional(e,
j[1])]);else if(m&&j[0]==m[0]&&(j[0]=="return"||j[0]=="throw")&&j[1]&&m[1])l=best_of(l,[j[0],make_conditional(e,j[1],m[1])]);else if(m&&aborts(j)){l=[["if",e,j]];if(m[0]=="block"){if(m[1])l=l.concat(m[1])}else l.push(m);l=k(["block",l])}else if(j&&aborts(m)){l=[["if",i(e),m]];if(j[0]=="block"){if(j[1])l=l.concat(j[1])}else l.push(j);l=k(["block",l])}return l}function s(e,j){return when_constant(e,function(m,l){if(l)return["for",null,null,null,k(j)];else{warn_unreachable(j);return["block"]}})}c=defaults(c,
{make_seqs:true,dead_code:true,keep_comps:true,no_warnings:false});var t=ast_walker(),k=t.walk,v;return t.with_walkers({sub:function(e,j){if(j[0]=="string"){var m=j[1];if(is_identifier(m))return["dot",k(e),m]}},"if":g,toplevel:function(e){return["toplevel",o(this.scope,function(){return f(MAP(e,k))})]},"switch":function(e,j){var m=j.length-1;return["switch",k(e),MAP(j,function(l,u){var q=f(MAP(l[1],k));if(u==m&&q.length>0){var y=q[q.length-1];y[0]=="break"&&!y[1]&&q.pop()}return[l[0]?k(l[0]):null,
q]})]},"function":function(){var e=n.apply(this,arguments);if(e[1]&&!HOP(v.refs,e[1]))e[1]=null;return e},defun:n,block:function(e){if(e){e=["block",f(MAP(e,k))];if(e!=null&&e[0]=="block"&&e[1])if(e[1].length==1)e=e[1][0];else if(e[1].length==0)e=["block"];return e}},binary:function(e,j,m){return when_constant(["binary",e,k(j),k(m)],function(l){return best_of(k(l),this)},function(){return this})},conditional:function(e,j,m){return make_conditional(k(e),k(j),k(m))},"try":function(e,j,m){return["try",
f(MAP(e,k)),j!=null?[j[0],f(MAP(j[1],k))]:null,m!=null?f(MAP(m,k)):null]},"unary-prefix":function(e,j){j=k(j);var m=["unary-prefix",e,j];if(e=="!")m=best_of(m,i(j));return when_constant(m,function(l){return k(l)},function(){return m})},name:function(e){switch(e){case "true":return["unary-prefix","!",["num",0]];case "false":return["unary-prefix","!",["num",1]]}},"new":function(e,j){if(e[0]=="name"&&e[1]=="Array"&&!v.has("Array"))return j.length!=1?["array",j]:["call",["name","Array"],j]},call:function(e,
j){if(e[0]=="name"&&e[1]=="Array"&&j.length!=1&&!v.has("Array"))return["array",j]},"while":s,"do":s},function(){return k(ast_add_scope(a))})}var DOT_CALL_NO_PARENS=jsp.array_to_hash(["name","array","string","dot","sub","call","regexp"]);
function make_string(a,c){var i=0,o=0;a=a.replace(/[\\\b\f\n\r\t\x22\x27]/g,function(n){switch(n){case "\\":return"\\\\";case "\u0008":return"\\b";case "\u000c":return"\\f";case "\n":return"\\n";case "\r":return"\\r";case "\t":return"\\t";case '"':++i;return'"';case "'":++o;return"'"}return n});if(c)a=to_ascii(a);return i>o?"'"+a.replace(/\x27/g,"\\'")+"'":'"'+a.replace(/\x22/g,'\\"')+'"'}
function to_ascii(a){return a.replace(/[\u0080-\uffff]/g,function(c){for(c=c.charCodeAt(0).toString(16);c.length<4;)c="0"+c;return"\\u"+c})}
function gen_code(a,c){function i(b){return make_string(b,c.ascii_only)}function o(b){b=b.toString();if(c.ascii_only)b=to_ascii(b);return b}function n(b){if(b==null)b="";if(y)b=repeat_string(" ",c.indent_start+A*c.indent_level)+b;return b}function f(b,d){if(d==null)d=1;A+=d;try{return b.apply(null,slice(arguments,1))}finally{A-=d}}function g(b){if(y)return b.join(" ");for(var d=[],h=0;h<b.length;++h){var r=b[h+1];d.push(b[h]);if(r&&(/[a-z0-9_\x24]$/i.test(b[h].toString())&&/^[a-z0-9_\x24]/i.test(r.toString())||
/[\+\-]$/.test(b[h].toString())&&/^[\+\-]/.test(r.toString())))d.push(" ")}return d.join("")}function p(b){return b.join(","+B)}function s(b){for(var d=q(b),h=1;h<arguments.length;++h){var r=arguments[h];if(r instanceof Function&&r(b)||b[0]==r)return"("+d+")"}return d}function t(b){if(b.length==1)return b[0];if(b.length==2){var d=b[1];b=b[0];return b.length<=d.length?b:d}return t([b[0],t(b.slice(1))])}function k(b){if(b[0]=="function")for(var d=slice(C),h=d.pop(),r=d.pop();r;){if(r[0]=="stat")return true;
if(r[0]=="seq"&&r[1]===h||r[0]=="call"&&r[1]===h||r[0]=="binary"&&r[2]===h){h=r;r=d.pop()}else return false}return!HOP(DOT_CALL_NO_PARENS,b[0])}function v(b){var d=b.toString(10),h=[d.replace(/^0\./,".")];if(Math.floor(b)===b){h.push("0x"+b.toString(16).toLowerCase(),"0"+b.toString(8));if(b=/^(.*?)(0+)$/.exec(b))h.push(b[1]+"e"+b[2].length)}else if(b=/^0?\.(0+)(.*)$/.exec(b))h.push(b[2]+"e-"+(b[1].length+b[2].length),d.substr(d.indexOf(".")));return t(h)}function e(b,d,h,r){r=r||"function";if(b)r+=
" "+o(b);r+="("+p(MAP(d,o))+")";return g([r,l(h)])}function j(b){for(var d=[],h=b.length-1,r=0;r<=h;++r){var w=b[r],z=q(w);if(z!=";"){if(!y&&r==h)z=w[0]=="while"&&empty(w[2])||member(w[0],["for","for-in"])&&empty(w[4])||w[0]=="if"&&empty(w[2])&&!w[3]||w[0]=="if"&&w[3]&&empty(w[3])?z.replace(/;*\s*$/,";"):z.replace(/;+\s*$/,"");d.push(z)}}return MAP(d,n)}function m(b){var d=b.length;if(d==0)return"{}";return"{"+x+MAP(b,function(h,r){var w=h[1].length>0,z=f(function(){return n(h[0]?g(["case",q(h[0])+
":"]):"default:")},0.5)+(w?x+f(function(){return j(h[1]).join(x)}):"");if(!y&&w&&r<d-1)z+=";";return z}).join(x)+x+n("}")}function l(b){if(!b)return";";if(b.length==0)return"{}";return"{"+x+f(function(){return j(b).join(x)})+x+n("}")}function u(b){var d=b[0];b=b[1];if(b!=null)d=g([o(d),"=",q(b)]);return d}function q(b){var d=b[0],h=D[d];if(!h)throw Error("Can't find generator for \""+d+'"');C.push(b);b=h.apply(d,b.slice(1));C.pop();return b}c=defaults(c,{indent_start:0,indent_level:4,quote_keys:false,
space_colon:false,beautify:false,ascii_only:false});var y=!!c.beautify,A=0,x=y?"\n":"",B=y?" ":"",D={string:i,num:v,name:o,toplevel:function(b){return j(b).join(x+x)},block:l,"var":function(b){return"var "+p(MAP(b,u))+";"},"const":function(b){return"const "+p(MAP(b,u))+";"},"try":function(b,d,h){b=["try",l(b)];d&&b.push("catch","("+d[0]+")",l(d[1]));h&&b.push("finally",l(h));return g(b)},"throw":function(b){return g(["throw",q(b)])+";"},"new":function(b,d){d=d.length>0?"("+p(MAP(d,q))+")":"";return g(["new",
s(b,"seq","binary","conditional","assign",function(h){var r=ast_walker(),w={};try{r.with_walkers({call:function(){throw w;},"function":function(){return this}},function(){r.walk(h)})}catch(z){if(z===w)return true;throw z;}})+d])},"switch":function(b,d){return g(["switch","("+q(b)+")",m(d)])},"break":function(b){var d="break";if(b!=null)d+=" "+o(b);return d+";"},"continue":function(b){var d="continue";if(b!=null)d+=" "+o(b);return d+";"},conditional:function(b,d,h){return g([s(b,"assign","seq","conditional"),
"?",s(d,"seq"),":",s(h,"seq")])},assign:function(b,d,h){if(b&&b!==true)b+="=";else b="=";return g([q(d),b,s(h,"seq")])},dot:function(b){var d=q(b),h=1;if(b[0]=="num")d+=".";else if(k(b))d="("+d+")";for(;h<arguments.length;)d+="."+o(arguments[h++]);return d},call:function(b,d){var h=q(b);if(k(b))h="("+h+")";return h+"("+p(MAP(d,function(r){return s(r,"seq")}))+")"},"function":e,defun:e,"if":function(b,d,h){b="("+q(b)+")";if(h)a:if(d[0]=="do")d=q(["block",[d]]);else{for(var r=d;;){var w=r[0];if(w==
"if"){if(!r[3]){d=q(["block",[d]]);break a}r=r[3]}else if(w=="while"||w=="do")r=r[2];else if(w=="for"||w=="for-in")r=r[4];else break}d=q(d)}else d=q(d);d=["if",b,d];h&&d.push("else",q(h));return g(d)},"for":function(b,d,h,r){var w=["for"];b=(b!=null?q(b):"").replace(/;*\s*$/,";"+B);d=(d!=null?q(d):"").replace(/;*\s*$/,";"+B);h=(h!=null?q(h):"").replace(/;*\s*$/,"");b=b+d+h;if(b=="; ; ")b=";;";w.push("("+b+")",q(r));return g(w)},"for-in":function(b,d,h,r){return g(["for","("+(b?q(b).replace(/;+$/,
""):q(d)),"in",q(h)+")",q(r)])},"while":function(b,d){return g(["while","("+q(b)+")",q(d)])},"do":function(b,d){return g(["do",q(d),"while","("+q(b)+")"])+";"},"return":function(b){var d=["return"];b!=null&&d.push(q(b));return g(d)+";"},binary:function(b,d,h){var r=q(d),w=q(h);if(member(d[0],["assign","conditional","seq"])||d[0]=="binary"&&PRECEDENCE[b]>PRECEDENCE[d[1]])r="("+r+")";if(member(h[0],["assign","conditional","seq"])||h[0]=="binary"&&PRECEDENCE[b]>=PRECEDENCE[h[1]]&&!(h[1]==b&&member(b,
["&&","||","*"])))w="("+w+")";return g([r,b,w])},"unary-prefix":function(b,d){var h=q(d);d[0]=="num"||d[0]=="unary-prefix"&&!HOP(OPERATORS,b+d[1])||!k(d)||(h="("+h+")");return b+(jsp.is_alphanumeric_char(b.charAt(0))?" ":"")+h},"unary-postfix":function(b,d){var h=q(d);d[0]=="num"||d[0]=="unary-postfix"&&!HOP(OPERATORS,b+d[1])||!k(d)||(h="("+h+")");return h+b},sub:function(b,d){var h=q(b);if(k(b))h="("+h+")";return h+"["+q(d)+"]"},object:function(b){if(b.length==0)return"{}";return"{"+x+f(function(){return MAP(b,
function(d){if(d.length==3)return n(e(d[0],d[1][2],d[1][3],d[2]));var h=d[0];d=q(d[1]);if(c.quote_keys)h=i(h);else if((typeof h=="number"||!y&&+h+""==h)&&parseFloat(h)>=0)h=v(+h);else is_identifier(h)||(h=i(h));return n(g(y&&c.space_colon?[h,":",d]:[h+":",d]))}).join(","+x)})+x+n("}")},regexp:function(b,d){return"/"+b+"/"+d},array:function(b){if(b.length==0)return"[]";return g(["[",p(MAP(b,function(d){if(!y&&d[0]=="atom"&&d[1]=="undefined")return"";return s(d,"seq")})),"]"])},stat:function(b){return q(b).replace(/;*\s*$/,
";")},seq:function(){return p(MAP(slice(arguments),q))},label:function(b,d){return g([o(b),":",q(d)])},"with":function(b,d){return g(["with","("+q(b)+")",q(d)])},atom:function(b){return o(b)}},C=[];return q(a)}
function split_lines(a,c){var i=[0];jsp.parse(function(){function o(){var p=n.apply(this,arguments);a:{if(g)if(g.type=="keyword")break a;if(p.pos-f>c)switch(p.type){case "keyword":case "atom":case "name":case "punc":f=p.pos;i.push(f)}}return g=p}var n=jsp.tokenizer(a),f=0,g;o.context=function(){return n.context.apply(this,arguments)};return o}());return i.map(function(o,n){return a.substring(o,i[n+1]||a.length)}).join("\n")}
function repeat_string(a,c){if(c<=0)return"";if(c==1)return a;var i=repeat_string(a,c>>1);i+=i;if(c&1)i+=a;return i}function defaults(a,c){var i={};if(a===true)a={};for(var o in c)if(HOP(c,o))i[o]=a&&HOP(a,o)?a[o]:c[o];return i}function is_identifier(a){return/^[a-z_$][a-z0-9_$]*$/i.test(a)&&a!="this"&&!HOP(jsp.KEYWORDS_ATOM,a)&&!HOP(jsp.RESERVED_WORDS,a)&&!HOP(jsp.KEYWORDS,a)}function HOP(a,c){return Object.prototype.hasOwnProperty.call(a,c)}var MAP;
(function(){function a(c){this.v=c}MAP=function(c,i,o){for(var n=[],f=0;f<c.length;++f){var g=i.call(o,c[f],f);g instanceof a?n.unshift(g.v):n.push(g)}return n};MAP.at_top=function(c){return new a(c)}})();exports.ast_walker=ast_walker;exports.ast_mangle=ast_mangle;exports.ast_squeeze=ast_squeeze;exports.gen_code=gen_code;exports.ast_add_scope=ast_add_scope;exports.ast_squeeze_more=require("./squeeze-more").ast_squeeze_more;exports.set_logger=function(a){warn=a};exports.make_string=make_string;
exports.split_lines=split_lines;