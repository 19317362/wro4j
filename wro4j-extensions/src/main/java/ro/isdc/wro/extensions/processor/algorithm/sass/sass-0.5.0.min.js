function Property(a,b){this.name=a,this.val=b}function Selector(a,b,c){this.string=a,b?b.adopt(this):b=null,this.properties=[],this.children=[],this.type=c,c&&(this[c]=!0)}function compile(a){return a.join("\n")}function parse(tokens){function performSubstitutions(input){return input.replace(/!([\w\-]+)/g,function(a,b){return data.variables[b]||a}).replace(/\{(.*?)\}/g,function(_,js){with(data.variables)return eval(js)})}function reset(){if(indents===0)return selector=null;while(lastIndents-->indents)selector=selector.parent}function error(a){throw new Error("ParseError: on line "+line+"; "+a)}var token,selector,data={variables:{},mixins:{},selectors:[]},line=1,lastIndents=0,indents=0;while(token=tokens.shift())switch(token[0]){case"mixin":if(indents){var mixin=data.mixins[token[1][1]];mixin||error("mixin `"+token[1][1]+"' does not exist"),selector.adopt(mixin.copy())}else data.mixins[token[1][1]]=selector=new Selector(token[1][1],null,"mixin");break;case"continuation":reset(),selector=new Selector(token[1][1],selector,"continuation");break;case"selector":reset(),selector=new Selector(token[1][1],selector),selector.parent||data.selectors.push(selector);break;case"property":reset(),selector||error("properties must be nested within a selector");var val=performSubstitutions(token[1][2]);selector.properties.push(new Property(token[1][1],val));break;case"property.expand":exports.expansions.forEach(function(a){tokens.unshift(["property",[,a+token[1][1],token[1][2]]])});break;case"variable":case"variable.alternate":var val=performSubstitutions(token[1][2]);data.variables[token[1][1]]=val;break;case"js":with(data.variables)eval(token[1][1]);break;case"nl":++line,indents=0;break;case"comment":break;case"indent":++line,lastIndents=indents,indents=(token[1][0].length-1)/2,indents>lastIndents&&indents-1>lastIndents&&error("invalid indentation, to much nesting")}return data}function tokenize(a){var b,c,d=[];while(a.length){for(var e=0,f=tokens.length;e<f;++e)if(c=tokens[e][1].exec(a)){b=[tokens[e][0],c],a=a.replace(tokens[e][1],"");break}if(b)d.push(b),b=null;else throw new Error("SyntaxError: near `"+a.slice(0,25).replace("\n","\\n")+"'")}return d}exports.version="0.5.0";var cache={},tokens=[["indent",/^\n +/],["space",/^ +/],["nl",/^\n/],["js",/^{(.*?)}/],["comment",/^\/\/(.*)/],["string",/^(?:'(.*?)'|"(.*?)")/],["variable",/^!([\w\-]+) *= *([^\n]+)/],["variable.alternate",/^([\w\-]+): +([^\n]+)/],["property.expand",/^=([\w\-]+) *([^\n]+)/],["property",/^:([\w\-]+) *([^\n]+)/],["continuation",/^&(.+)/],["mixin",/^\+([\w\-]+)/],["selector",/^(.+)/]];exports.expansions=["-moz-","-webkit-"],exports.collect=function(a){return parse(tokenize(a))},exports.render=function(a,b){b=b||{};if(b.cache&&!b.filename)throw new Error("filename option must be passed when cache is enabled");if(b.cache)return cache[b.filename]?cache[b.filename]:cache[b.filename]=compile(exports.collect(a).selectors);return compile(exports.collect(a).selectors)},Selector.prototype.copy=function(){var a=new Selector(this.string,this.parent,this.type);a.properties=this.properties.map(function(a){return a.copy()}),this.children.map(function(b){a.adopt(b.copy())});return a},Selector.prototype.orphan=function(){if(this.parent){var a=this.parent.children.indexOf(this);a!==-1&&this.parent.children.splice(a,1)}},Selector.prototype.adopt=function(a){a.orphan(),a.parent=this,this.children.push(a)},Selector.prototype.selector=function(){var a=this.string;this.parent&&(a=this.continuation?this.parent.selector()+a:this.mixin?this.parent.selector():this.parent.selector()+" "+a);return a},Selector.prototype.toString=function(){return(this.properties.length?this.selector()+" {\n"+this.properties.join("\n")+"}\n":"")+this.children.join("")},Property.prototype.copy=function(){return new Property(this.name,this.val)},Property.prototype.toString=function(){return"  "+this.name+": "+this.val+";"}